# Project Cleanup Plan

Generated by knip analysis on 2025-10-23

## ✅ COMPLETED - Cleanup Successful

All cleanup tasks have been completed successfully. The project is now cleaner, with reduced dependencies and better configuration.

## Executive Summary

**Original Issues:**

- 7 unused files
- 6 unused dependencies (2 prod + 4 dev)
- 3 unlisted dependencies
- 1 unused exported type
- 1 duplicate export

**All issues have been resolved:**

- ✅ All 7 unused files deleted
- ✅ 2 unused production dependencies removed (react-markdown, @tanstack/react-query) - **saved 78 packages**
- ✅ 3 unlisted dependencies added (clsx, postcss-load-config, @vitest/coverage-v8)
- ✅ Unused exported type fixed
- ✅ Duplicate export removed
- ✅ knip.json configuration optimized
- ✅ Build verified successful

## Issues Found

### 1. Unused Files (7)

These files exist but are not imported or used anywhere in the codebase:

- **src/components/layout/Header.tsx** - Old header component (likely replaced by new layout)
- **src/components/layout/MobileNav.tsx** - Old mobile navigation (likely replaced)
- **src/components/monsters/MonsterForm.tsx** - Unused monster form component
- **src/lib/utils/api.ts** - Utility functions not being used
- **src/lib/utils/auth.ts** - Authentication utilities not being used
- **src/lib/utils/encounters.ts** - Encounter calculation utilities not being used
- **src/lib/utils/validation.ts** - Validation utilities not being used

**Action:** Review each file to confirm it's truly unused, then delete. Consider if any logic should be migrated elsewhere before deletion.

**Priority:** Medium - These files add to bundle size and maintenance burden

### 2. Unused Dependencies (2)

Production dependencies that are installed but never imported:

- **@tanstack/react-query** (package.json:41:6)
  - This is concerning as react-query is typically important for data fetching
  - Need to verify if this should actually be used or can be removed

- **react-markdown** (package.json:51:6)
  - Markdown rendering library not currently used
  - May have been planned for future features

**Action:**

1. For @tanstack/react-query: Verify if this was intentionally not implemented yet or if it's truly not needed
2. For react-markdown: Remove if no immediate plans to use it, or add to a "future features" tracking document

**Priority:** High - Unused prod dependencies increase bundle size and installation time

### 3. Unused DevDependencies (4)

Development dependencies that appear to be unused:

- **eslint-config-next** (package.json:69:6)
  - This is suspicious as Next.js projects typically use this
  - May be indirectly used through Next.js's ESLint config

- **eslint-config-prettier** (package.json:70:6)
  - Used to disable conflicting ESLint rules when using Prettier
  - May be indirectly used

- **eslint-plugin-prettier** (package.json:71:6)
  - Runs Prettier as an ESLint rule
  - May be indirectly used

- **supabase** (package.json:78:6)
  - The Supabase CLI package
  - This is definitely needed for local development even if not directly imported

**Action:**

1. Review ESLint configuration to confirm which of these are actually needed
2. Keep supabase CLI - it's needed for database migrations and local dev
3. Consider marking some as exceptions in knip config if they're used indirectly

**Priority:** Low-Medium - These only affect development, not production

### 4. Unlisted Dependencies (3)

Dependencies that are used in the code but not listed in package.json:

- **clsx** (lib/utils.ts:2:10)
  - Used for conditional className merging
  - Should be added to dependencies

- **postcss-load-config** (postcss.config.mjs:1:2)
  - PostCSS configuration loader
  - Should be added to devDependencies

- **@vitest/coverage-v8** (vitest.config.mjs)
  - Vitest coverage reporter
  - Should be added to devDependencies

**Action:** Add all three to package.json in the appropriate section

**Priority:** High - These could cause build failures in fresh installs

### 5. Unused Exported Types (1)

- **SpellListProps** interface (src/components/spells/SpellList.tsx:32:18)
  - Exported but never imported elsewhere
  - Can likely be made non-exported or removed if not used internally

**Action:** Review and either remove the export or the interface entirely if unused

**Priority:** Low - Minor code cleanliness issue

## Recommended Cleanup Order

### Phase 1: Fix Critical Issues (High Priority)

1. **Add unlisted dependencies** to package.json
   - Install: clsx, postcss-load-config, @vitest/coverage-v8
   - Run: `npm install --save clsx`
   - Run: `npm install --save-dev postcss-load-config @vitest/coverage-v8`

2. **Verify @tanstack/react-query usage**
   - Check if it should be used for data fetching
   - If not needed, remove it
   - If needed, implement it where appropriate

3. **Review and remove unused production dependencies**
   - Remove react-markdown if not needed: `npm uninstall react-markdown`

### Phase 2: Clean Up Files (Medium Priority)

4. **Archive or delete unused files**
   - Create a backup branch first: `git checkout -b backup/unused-files`
   - Review each unused file for any valuable logic
   - Delete confirmed unused files
   - Commit changes

### Phase 3: Optimize Dev Dependencies (Low-Medium Priority)

5. **Review ESLint configuration**
   - Check .eslintrc or eslint.config.js to see what's actually used
   - Update knip.json to ignore legitimately used dev dependencies
   - Remove truly unused dev dependencies (carefully)

### Phase 4: Code Quality (Low Priority)

6. **Clean up unused exports**
   - Make SpellListProps non-exported if only used internally
   - Remove entirely if not used at all

7. **Update knip configuration**
   - Fix the configuration hints from knip
   - Remove ignoreDependencies that aren't actually used
   - Refine entry patterns

## Knip Configuration Improvements

Based on the configuration hints, update knip.json:

```json
{
  "$schema": "https://unpkg.com/knip@5/schema.json",
  "entry": [
    "app/**/*.{ts,tsx}",
    "components/**/*.{ts,tsx}",
    "lib/**/*.{ts,tsx}"
  ],
  "project": [
    "**/*.{ts,tsx,js,jsx,mjs}",
    "!**/*.test.{ts,tsx}",
    "!**/*.spec.{ts,tsx}"
  ],
  "ignore": [
    "scripts/**",
    "supabase/**",
    ".next/**",
    "node_modules/**",
    "dist/**",
    "build/**",
    "coverage/**"
  ],
  "ignoreDependencies": ["supabase"]
}
```

## Success Criteria

After cleanup:

- [ ] All unlisted dependencies are in package.json
- [ ] No unused production dependencies remain
- [ ] Unused files are deleted or archived
- [ ] knip runs with minimal warnings
- [ ] `npm run build` succeeds
- [ ] `npm run test` succeeds
- [ ] Application still works in dev and production

## Estimated Time

- Phase 1: 30 minutes
- Phase 2: 1-2 hours (including testing)
- Phase 3: 1 hour
- Phase 4: 30 minutes

**Total: 3-4 hours**

## Risks and Mitigation

1. **Risk:** Deleting files that are actually needed but knip didn't detect
   - **Mitigation:** Create backup branch, test thoroughly after each deletion

2. **Risk:** Breaking ESLint/Prettier setup
   - **Mitigation:** Keep all ESLint/Prettier packages until proven unused

3. **Risk:** Build failures from missing dependencies
   - **Mitigation:** Add unlisted dependencies first before removing anything

## Next Steps

1. Review this plan and approve cleanup approach
2. Create a feature branch: `git checkout -b cleanup/knip-analysis`
3. Execute Phase 1 (critical fixes)
4. Test and verify
5. Continue with subsequent phases
6. Create PR when complete

## Notes

- Run `npm run knip` after each phase to verify progress
- Consider adding knip to CI/CD pipeline to prevent future issues
- Update CLAUDE.md to include knip in development workflow
