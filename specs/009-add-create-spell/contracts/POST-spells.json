{
  "endpoint": "POST /api/spells",
  "description": "Create a new custom spell",
  "authentication": "required",
  "request": {
    "headers": {
      "Content-Type": "application/json"
    },
    "body": {
      "type": "object",
      "required": [
        "name",
        "tier",
        "classes",
        "duration",
        "range",
        "description"
      ],
      "properties": {
        "name": {
          "type": "string",
          "minLength": 1,
          "maxLength": 100,
          "description": "Spell name (must be globally unique)",
          "example": "Eldritch Blast"
        },
        "tier": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5,
          "description": "Spell power level (Shadowdark standard)",
          "example": 3
        },
        "classes": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["wizard", "priest"]
          },
          "minItems": 1,
          "description": "Spell-casting classes that can use this spell",
          "example": ["wizard"]
        },
        "duration": {
          "type": "string",
          "minLength": 1,
          "description": "Spell duration (free text)",
          "example": "Concentration, up to 1 minute"
        },
        "range": {
          "type": "string",
          "minLength": 1,
          "description": "Spell range (free text)",
          "example": "120 feet"
        },
        "description": {
          "type": "string",
          "minLength": 1,
          "description": "Spell effect and mechanics",
          "example": "A beam of crackling energy streaks toward a creature within range. Make a ranged spell attack against the target. On a hit, the target takes 1d10 force damage."
        },
        "author_notes": {
          "type": "string",
          "description": "Optional notes or school of magic",
          "example": "Evocation"
        },
        "is_public": {
          "type": "boolean",
          "default": false,
          "description": "Whether the spell is publicly visible",
          "example": false
        }
      }
    }
  },
  "responses": {
    "201": {
      "description": "Spell created successfully",
      "body": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "example": "550e8400-e29b-41d4-a716-446655440000"
          },
          "name": {
            "type": "string",
            "example": "Eldritch Blast"
          },
          "slug": {
            "type": "string",
            "example": "eldritch-blast"
          },
          "tier": {
            "type": "integer",
            "example": 3
          },
          "classes": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "example": ["wizard"]
          },
          "duration": {
            "type": "string",
            "example": "Concentration, up to 1 minute"
          },
          "range": {
            "type": "string",
            "example": "120 feet"
          },
          "description": {
            "type": "string",
            "example": "A beam of crackling energy streaks toward a creature within range..."
          },
          "author_notes": {
            "type": "string",
            "nullable": true,
            "example": "Evocation"
          },
          "source": {
            "type": "string",
            "example": "Custom"
          },
          "is_public": {
            "type": "boolean",
            "example": false
          },
          "user_id": {
            "type": "string",
            "format": "uuid"
          },
          "creator_id": {
            "type": "string",
            "format": "uuid",
            "nullable": true
          },
          "created_at": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-12T10:30:00Z"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time",
            "example": "2025-11-12T10:30:00Z"
          }
        }
      }
    },
    "400": {
      "description": "Validation error",
      "body": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "Validation error"
          },
          "details": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "path": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  }
                },
                "message": {
                  "type": "string"
                }
              }
            },
            "example": [
              {
                "path": ["tier"],
                "message": "Tier must be between 1 and 5"
              }
            ]
          }
        }
      }
    },
    "401": {
      "description": "Authentication required",
      "body": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "Authentication required"
          }
        }
      }
    },
    "409": {
      "description": "Spell name already exists",
      "body": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "Spell name already exists"
          }
        }
      }
    },
    "500": {
      "description": "Internal server error",
      "body": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "example": "Failed to create spell"
          }
        }
      }
    }
  },
  "testScenarios": [
    {
      "name": "Create valid wizard spell",
      "request": {
        "name": "Test Spell",
        "tier": 3,
        "classes": ["wizard"],
        "duration": "Instantaneous",
        "range": "Self",
        "description": "A test spell effect",
        "is_public": false
      },
      "expectedStatus": 201,
      "assertions": [
        "response.id is UUID",
        "response.slug === 'test-spell'",
        "response.user_id === currentUser.id",
        "response.created_at exists"
      ]
    },
    {
      "name": "Create spell with invalid tier",
      "request": {
        "name": "Invalid Spell",
        "tier": 6,
        "classes": ["wizard"],
        "duration": "Instantaneous",
        "range": "Self",
        "description": "Test"
      },
      "expectedStatus": 400,
      "assertions": [
        "response.error === 'Validation error'",
        "response.details includes tier error"
      ]
    },
    {
      "name": "Create spell without auth",
      "authenticated": false,
      "request": {
        "name": "Spell",
        "tier": 1,
        "classes": ["wizard"],
        "duration": "Instantaneous",
        "range": "Self",
        "description": "Test"
      },
      "expectedStatus": 401
    },
    {
      "name": "Create spell with duplicate name",
      "request": {
        "name": "Fireball",
        "tier": 3,
        "classes": ["wizard"],
        "duration": "Instantaneous",
        "range": "150 feet",
        "description": "Duplicate of official spell"
      },
      "expectedStatus": 409,
      "assertions": ["response.error includes 'already exists'"]
    }
  ]
}
